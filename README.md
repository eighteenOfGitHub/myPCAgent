# Your Agent Project â€” æŠ€æœ¯æ–‡æ¡£ï¼ˆv0.2.xï¼‰

---

## ä¸€ã€é¡¹ç›®ä»‹ç»

**Your Agent Project** æ˜¯ä¸€ä¸ªé¢å‘ä¸ªäºº PC çš„æœ¬åœ° AI Agent æ¡†æ¶ï¼Œæ—¨åœ¨æä¾›ï¼š

- **èƒ½åŠ›è·¯ç”±**ï¼šç»Ÿä¸€ç®¡ç†æœ¬åœ°/è¿œç¨‹çš„ LLMã€Embeddingã€å·¥å…·ç­‰ **ç³»ç»Ÿèƒ½åŠ›**ï¼Œæ”¯æŒä¼˜å…ˆçº§è°ƒåº¦ä¸èƒ½åŠ›åŒ¹é…ï¼›
- **å·¥å…·é›†æˆ**ï¼šé€šè¿‡ MCPï¼ˆModel Calling Protocolï¼‰æ ‡å‡†æ¥å…¥å¤–éƒ¨å·¥å…·ï¼ˆå¦‚æœç´¢ã€ä»£ç æ‰§è¡Œã€è¯­éŸ³ï¼‰ï¼›
- **å¯¹è¯ç®¡ç†**ï¼šè®°å½•ä¼šè¯ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®äº¤äº’ä¸å·¥å…·è°ƒç”¨é“¾ï¼›
- **é…ç½®æŒä¹…åŒ–**ï¼šæ‰€æœ‰ **ç³»ç»Ÿèƒ½åŠ›çš„å…ƒæ•°æ®**ï¼ˆå¦‚æ¨¡å‹åç§°ã€ç«¯ç‚¹ã€çŠ¶æ€ç­‰ï¼‰å­˜å‚¨äºæœ¬åœ° SQLite æ•°æ®åº“ï¼›
- **å¯è§‚æµ‹æ€§**ï¼šç³»ç»Ÿè¿è¡Œæ—¥å¿—ä»¥ **ç»“æ„åŒ–æ–‡æœ¬æ–‡ä»¶å½¢å¼å¤‡ä»½**ï¼Œä¾¿äºè°ƒè¯•ä¸å®¡è®¡ï¼›
- **Web ç®¡ç†ç•Œé¢**ï¼šåŸºäº **Gradio** æä¾›äº¤äº’å¼å‰ç«¯ï¼Œæ”¯æŒèƒ½åŠ›é…ç½®ç®¡ç†ã€æ—¥å¿—æŸ¥çœ‹ã€å®æ—¶èŠå¤©ã€‚

---

## äºŒã€ç‰ˆæœ¬æ–°å¢

### v0.2.5
- feat: å‰ç«¯æäº¤ LLM é…ç½®å‰ä½¿ç”¨ Fernet å¯¹ api_key åŠ å¯†ï¼ˆshared/cryptoï¼‰
- feat: åç«¯ LLMSettingService è§£å¯†åè°ƒç”¨ï¼Œæ•°æ®åº“å­˜å¯†æ–‡
- chore: EnvConfig ç¼ºå¤± FERNET_KEY æ—¶è‡ªåŠ¨ç”Ÿæˆå¹¶å†™å› env_config.yamlï¼Œç¡®ä¿å‰åç«¯åŒé’¥
- docs: è¡¥å…… EnvConfig ä¸ç›‘æ§/è¿ç»´è¯´æ˜

### v0.2.4
- refactor: sharedä¸­schemasçš„å“åº”ä½“æ¨¡å‹æŒ‰ç…§api/endpointæ‹†åˆ†åˆ°sharedä¸‹çš„ä¸åŒæ–‡ä»¶ï¼ŒæŒ‰ç…§å¯¹åº”endpointå‘½å
- refactor: ç§»é™¤çƒ­é‡è½½åŠŸèƒ½ï¼Œç®€åŒ–å¯åŠ¨æµç¨‹

### v0.2.3
- feat: è®¾ç½®é¡µé¢æ˜¾ç¤ºå·²ä¿å­˜æ¨¡å‹

### v0.2.2
- bulid: æ—¥å¿—ç³»ç»Ÿ
- faet: å‰ç«¯åˆ†é¡µ
- feat: æ·»åŠ å¤§æ¨¡å‹é…ç½®

### v0.2.1 
 - feat: å¯åŠ¨é¡¹ä¸çƒ­é‡è½½  
 - fix: chatbox å†å²èŠå¤©è®°å½•ä¸æ˜¾ç¤º

### v0.2.0
 - build: å‰åç«¯åˆ†ç¦»

---

## ä¸‰ã€é¡¹ç›®ç»“æ„

```
.
|   .gitignore
|   clear_cache.py
|   generate_tree.bat
|   README.md
|   start.bat
|   tree.txt
|   
+---backend
|   |   main.py
|   |   __init__.py
|   |   
|   +---api
|   |   |   router.py
|   |   |   __init__.py
|   |   |   
|   |   \---endpoints
|   |           chat.py
|   |           greeting.py
|   |           health.py
|   |           llm_setting.py
|   |           user_preference.py
|   |           __init__.py
|   |           
|   +---core
|   |   |   database.py
|   |   |   logger.py
|   |   |   __init__.py
|   |   |   
|   |   +---config
|   |   |       back_config.py
|   |   |       back_config.yaml
|   |   |       log_config.yaml
|   |   |       __init__.py
|   |   |       
|   |   \---utils
|   +---data
|   |       pcagent.db
|   |       
|   +---db_models
|   |       chat_models.py
|   |       user_config.py
|   |       __init__.py
|   |       
|   +---logs
|   |       app.log
|   |       
|   +---middleware
|   |       logging_middleware.py
|   |       
|   +---migrations
|   |       __init__.py
|   |       
|   \---services
|           chat_service.py
|           greeting_service.py
|           llm_setting_service.py
|           user_preference_service.py
|           __init__.py
|           
+---config
|       env_config.py
|       env_config.yaml
|       __init__.py
|       
+---docs
|   +---development
|   |   +---services
|   |   \---sys
|   |           AIç¼–ç¨‹è§„èŒƒ.md
|   |           åç«¯æœåŠ¡å¼€å‘è§„èŒƒä¸æµç¨‹é€ŸæŸ¥æ‰‹å†Œ.md
|   |           æ—¥å¿—ç³»ç»Ÿå¼€å‘è§„èŒƒæ–‡æ¡£.md
|   |           
|   \---notes
|       |   ideas.md
|       |   
|       +---notes_from_error
|       |       database_note.md
|       |       logging_note.md
|       |       project_note.md
|       |       python_note.md
|       |       
|       \---systematic_note
|               githubä»£ç ç®¡ç†ä¸åä½œå¼€å‘è§„èŒƒ.md
|               
+---frontend
|   |   app.py
|   |   __init__.py
|   |   
|   +---handlers
|   |       chat.py
|   |       dashboard.py
|   |       llm_setting.py
|   |       
|   \---ui
|       |   main_layout.py
|       |   
|       \---pages
|               agent.py
|               chat.py
|               dashboard.py
|               general_setting.py
|               llm_setting.py
|               settings.py
|               __init__.py
|               
\---shared
        chat.py
        crypto.py
        greeting.py
        llm_setting.py
        schemas.py
        user_preference.py
        __init__.py
        

```

## å››ã€æŠ€æœ¯é€‰å‹ä¸é…ç½®ç®¡ç†  

| ç±»åˆ« | æŠ€æœ¯/åº“ | ç‰ˆæœ¬/è¯´æ˜ | é€‰å‹ç†ç”± |
|------|--------|----------|--------|
| **æ ¸å¿ƒè¯­è¨€** | Python | â‰¥ 3.10 | ç”Ÿæ€ä¸°å¯Œï¼ŒAI å·¥å…·é“¾æˆç†Ÿï¼Œå¼€å‘æ•ˆç‡é«˜ |
| **åç«¯æ¡†æ¶** | FastAPI | æœ€æ–°ç¨³å®šç‰ˆ | âœ… é«˜æ€§èƒ½ï¼ˆStarlette + Pydanticï¼‰<br>âœ… è‡ªåŠ¨ç”Ÿæˆ OpenAPI æ–‡æ¡£<br>âœ… å¼‚æ­¥åŸç”Ÿæ”¯æŒï¼ˆé€‚åˆ LLM æµå¼è°ƒç”¨ï¼‰<br>âœ… ä¸ SQLModel æ·±åº¦é›†æˆ |
| **å‰ç«¯æ¡†æ¶** | Gradio | â‰¥ 4.0 | âœ… åŸç”Ÿ `gr.ChatInterface` æ”¯æŒæµå¼èŠå¤©<br>âœ… `gr.Dataframe` æä¾›å¼ºå¤§è¡¨æ ¼äº¤äº’ï¼ˆèƒ½åŠ›/å·¥å…·ç®¡ç†ï¼‰<br>âœ… å¿«é€Ÿæ„å»º AI äº¤äº’ç•Œé¢<br>âœ… å¯ç‹¬ç«‹éƒ¨ç½²ï¼Œé€šè¿‡ HTTP è°ƒç”¨åç«¯ API |
| **æ•°æ®åº“** | SQLite | å†…ç½®äº Python | âœ… é›¶é…ç½®ã€å•æ–‡ä»¶ã€ACID<br>âœ… å®Œç¾é€‚é…æœ¬åœ°å•æœºåœºæ™¯<br>âœ… ä»…å­˜å‚¨ **èƒ½åŠ›/å·¥å…·å…ƒæ•°æ®**ï¼ˆéæ—¥å¿—ã€éæ¨¡å‹ï¼‰<br>âŒ ä¸é€‚ç”¨äºé«˜å¹¶å‘æˆ–å¤šç”¨æˆ·ï¼ˆä½†æœ¬é¡¹ç›®æ— éœ€ï¼‰ |
| **ORM / æ•°æ®æ¨¡å‹** | SQLModel | æœ€æ–°ç¨³å®šç‰ˆ | âœ… **æ ¸å¿ƒé€‰æ‹©**ï¼š<br>â€ƒ- ç»Ÿä¸€ Pydantic + SQLAlchemy<br>â€ƒ- `SQLModel` ç±» = æ•°æ®åº“è¡¨ = API Schema<br>â€ƒ- è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œæ¶ˆé™¤æ¸¸æ ‡ç®¡ç†<br>â€ƒ- FastAPI å®˜æ–¹æ¨è<br>âœ… æ‰€æœ‰è¡¨ç»“æ„å®šä¹‰äº `backend/core/db_models/` |
| **æ—¥å¿—ç³»ç»Ÿ** | Python `logging` + `RotatingFileHandler` | æ ‡å‡†åº“ | âœ… **ä»…ä½¿ç”¨æ–‡ä»¶å¤‡ä»½**ï¼Œä¸å­˜æ•°æ®åº“<br>âœ… åˆ†ç¦» `runtime.log`ï¼ˆINFO+ï¼‰ä¸ `debug.log`ï¼ˆDEBUG+ï¼‰<br>âœ… æ”¯æŒæ—¥å¿—è½®è½¬ï¼ˆé˜²ç£ç›˜çˆ†æ»¡ï¼‰<br>âœ… æ ¼å¼å¯é…ç½®ï¼Œå…¼å®¹ `grep`/`tail` ç­‰å·¥å…· |
| **é…ç½®ç®¡ç†** | PyYAML + è‡ªå®šä¹‰ `ConfigLoader` | `pyyaml>=6.0` | âœ… é…ç½®é›†ä¸­äº `config/env_config.yaml`<br>âœ… åŠ¨æ€åŠ è½½ `system.version`ã€è·¯å¾„ã€æ—¥å¿—çº§åˆ«ç­‰<br>âœ… é¿å…ç¡¬ç¼–ç ï¼Œæ”¯æŒç¯å¢ƒå·®å¼‚åŒ–éƒ¨ç½² |
| **API è§„èŒƒ** | RESTful + JSON | â€” | âœ… `/api/v1/...` è·¯å¾„æ¸…æ™°<br>âœ… è¯·æ±‚/å“åº”ä½“ç”± SQLModel è‡ªåŠ¨ç”Ÿæˆ Pydantic æ¨¡å‹<br>âœ… å…¼å®¹æœªæ¥æ‰©å±•ï¼ˆv2, v3...ï¼‰ |
| **å…±äº«ç±»å‹** | `shared/v1/schemas.py` | ç”± SQLModel å¯¼å‡º | âœ… å‰åç«¯å…±ç”¨åŒä¸€å¥—æ•°æ®ç»“æ„å®šä¹‰<br>âœ… é¿å…ç±»å‹ä¸ä¸€è‡´å¯¼è‡´çš„ bug |
| **ç‰ˆæœ¬æ§åˆ¶** | è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆSemVerï¼‰ | `vx.x.x` | âœ… `VERSION` æ–‡ä»¶ + `env_config.yaml` å£°æ˜ç‰ˆæœ¬<br>âœ… æ•°æ®åº“ Schema ç‰ˆæœ¬ç‹¬ç«‹ç®¡ç†ï¼ˆç”¨äºè¿ç§»ï¼‰ |
| **ä»£ç é£æ ¼** | Black + isort | â€” | âœ… è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œä¿è¯ä»£ç ä¸€è‡´æ€§ï¼ˆå»ºè®®åŠ å…¥ CIï¼‰ |
| **å¯é€‰ï¼šæ‰“åŒ…/åˆ†å‘** | PyInstaller / Docker | â€” | âœ… æœªæ¥å¯æ‰“åŒ…ä¸ºå•æ–‡ä»¶ EXE æˆ–å®¹å™¨é•œåƒ |

---

### EnvConfig
- æ–‡ä»¶ï¼š`config/env_config.py` / `config/env_config.yaml`ã€‚
- ä½œç”¨ï¼šé›†ä¸­ç®¡ç†å‰åç«¯å…±äº«å‚æ•°ï¼ˆå¦‚ä¸»æœºç«¯å£ã€API åŸºç¡€åœ°å€ã€CORS æºï¼‰ã€‚
- å®‰å…¨ï¼šåŒ…å« `FERNET_KEY`ï¼ˆå¯¹ç§°å¯†é’¥ï¼‰ï¼Œç”¨äºå‰åç«¯åŠ è§£å¯†ï¼›ç¼ºå¤±æ—¶è‡ªåŠ¨ç”Ÿæˆå¹¶å†™å› YAMLï¼Œéœ€ç¡®ä¿å‰åç«¯è¯»å–åŒä¸€ä»½å¯†é’¥ã€‚ï¼ˆå»ºè®®é‡æ–°ç”Ÿæˆï¼‰

---

## äº”ã€ç¨‹åºå¯åŠ¨

Your Agent Project çš„å¯åŠ¨æµç¨‹æ¶‰åŠ**åç«¯ (FastAPI)** å’Œ**å‰ç«¯ (Gradio)** ä¸¤ä¸ªç‹¬ç«‹ä½†ååŒçš„æœåŠ¡ã€‚æ¨èé€šè¿‡æ ¹ç›®å½•ä¸‹çš„ `start.bat` è„šæœ¬ä¸€é”®å¯åŠ¨ã€‚

#### 1. æ€»å¯åŠ¨å™¨ (`start.bat`)
è¿™æ˜¯ç”¨æˆ·äº¤äº’çš„å”¯ä¸€å…¥å£ã€‚
- **ä½œç”¨**ï¼šå¹¶è¡Œå¯åŠ¨åç«¯å’Œå‰ç«¯æœåŠ¡ã€‚
- **æ‰§è¡Œæ–¹å¼**ï¼š
  - **Windows**: åŒå‡» `start.bat` æˆ–åœ¨ PowerShell/CMD ä¸­è¿è¡Œ `.\start.bat`ã€‚

#### 2. åç«¯å¯åŠ¨æµç¨‹ (`backend/main.py`)
å½“ `start.bat` è§¦å‘åç«¯å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1.  **åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ**ï¼šæ ¹æ® `core/config/log_config.yaml` é…ç½®æ—¥å¿—æ ¼å¼ä¸è¾“å‡ºã€‚
2.  **åˆå§‹åŒ–æ•°æ®åº“**ï¼šè°ƒç”¨ `core/database.py` è¿æ¥ `data/pcagent.db`ï¼Œå¹¶ç¡®ä¿è¡¨ç»“æ„å­˜åœ¨ã€‚
3.  **åˆ›å»º FastAPI åº”ç”¨**ï¼š
    - æ³¨å†Œ CORS ä¸­é—´ä»¶ï¼Œå…è®¸å‰ç«¯ (`frontend/`) è·¨åŸŸè®¿é—®ã€‚
    - æ³¨å†Œè‡ªå®šä¹‰ `LoggingMiddleware` ä»¥è®°å½•è¯·æ±‚ã€‚
    - æŒ‚è½½ API è·¯ç”± (`/api`)ï¼Œè·¯ç”±å®šä¹‰ä½äº `api/endpoints/`ã€‚
4.  **å¯åŠ¨æœåŠ¡å™¨**ï¼šä½¿ç”¨ Uvicorn åœ¨ `127.0.0.1:8000` (æˆ–é…ç½®æ–‡ä»¶æŒ‡å®šç«¯å£) ä¸Šå¯åŠ¨ HTTP æœåŠ¡ã€‚

> âœ… **å…³é”®ç‚¹**ï¼šåç«¯æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ RESTful API æœåŠ¡å™¨ï¼Œä¸ºå‰ç«¯æä¾›æ‰€æœ‰æ•°æ®å’Œä¸šåŠ¡é€»è¾‘æ¥å£ã€‚

#### 3. å‰ç«¯å¯åŠ¨æµç¨‹ (`frontend/app.py`)
å½“ `start.bat` è§¦å‘å‰ç«¯å¯åŠ¨æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
1.  **æ„å»º Gradio åº”ç”¨**ï¼š
    - ä½¿ç”¨ `ui/main_layout.py` å’Œ `pages/` ä¸‹çš„ç»„ä»¶æ„å»ºå®Œæ•´çš„ Web UIã€‚
    - UI åŒ…å«å¤šä¸ªæ ‡ç­¾é¡µï¼šèŠå¤© (`chat`)ã€ä»ªè¡¨ç›˜ (`dashboard`)ã€LLM æ¨¡å‹è®¾ç½® (`llm_models_setting`) ç­‰ã€‚
2.  **è¿æ¥åç«¯**ï¼šå‰ç«¯ UI ç»„ä»¶é€šè¿‡ HTTP è¯·æ±‚ï¼ˆå¦‚ `fetch`ï¼‰è°ƒç”¨åç«¯ `http://127.0.0.1:8000/api/...` çš„ APIã€‚
3.  **å¯åŠ¨æœåŠ¡å™¨**ï¼šGradio åœ¨ `127.0.0.1:7860` (é»˜è®¤ç«¯å£) ä¸Šå¯åŠ¨ä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œå¹¶è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ã€‚

> âœ… **å…³é”®ç‚¹**ï¼šå‰ç«¯æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Web åº”ç”¨ï¼Œå®ƒä¸å¤„ç†æ ¸å¿ƒä¸šåŠ¡ï¼Œåªè´Ÿè´£å±•ç¤ºå’Œç”¨æˆ·äº¤äº’ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½é€šè¿‡ API ä¸åç«¯åŒæ­¥ã€‚

#### ğŸ“Š å¯åŠ¨æµç¨‹å›¾ï¼ˆASCIIï¼‰
```
+---------------------+
| User runs:          |
| .\start.bat         |
+----------+----------+
           |
           v
+----------+----------+
| start.bat (Root)    |
|                     |
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   |
| â”‚ Start Backend â”‚â”€â”€â”€â”¼â”€â”€â”€â–¶ python backend/main.py
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   |      (Serves on http://127.0.0.1:8000)
|                     |
| â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   |
| â”‚ Start Frontendâ”‚â”€â”€â”€â”¼â”€â”€â”€â–¶ python frontend/app.py
| â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   |      (Serves on http://127.0.0.1:7860)
|                     |
+---------------------+
           |
           | (Graceful shutdown on Ctrl+C)
           â–¼
    [Both processes terminate]
```

#### ğŸ” è¿›ç¨‹å…³ç³»æ€»ç»“
| è¿›ç¨‹              | å¯åŠ¨æ–¹å¼         | ä¾èµ–               | é€šä¿¡æ–¹å¼                   |
| ----------------- | ---------------- | ------------------ | -------------------------- |
| `start.bat`       | ç”¨æˆ·ç›´æ¥è¿è¡Œ     | æ—                  | çˆ¶è¿›ç¨‹ï¼Œç®¡ç†å­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ |
| `backend/main.py` | `start.bat` å¯åŠ¨ | `config/`, `data/` | æä¾› HTTP API (`/api/...`) |
| `frontend/app.py` | `start.bat` å¯åŠ¨ | åç«¯ API å¯ç”¨æ€§    | é€šè¿‡ HTTP è°ƒç”¨åç«¯æ¥å£     |

---

## å…­ã€ç›¸å…³å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `.\start.bat` | å¯åŠ¨åç«¯ (FastAPI @ 8000) å’Œå‰ç«¯ (Gradio @ 7860) |
| `python backend/main.py` | å•ç‹¬å¯åŠ¨åç«¯æœåŠ¡ |
| `python frontend/app.py` | å•ç‹¬å¯åŠ¨å‰ç«¯æœåŠ¡ |
| `python clear_cache.py` | æ¸…ç† Python ç¼“å­˜æ–‡ä»¶ (`__pycache__`, `.pyc` ç­‰) |
| `.\generate_tree.bat` | ç”Ÿæˆé¡¹ç›®ç»“æ„æ ‘å¹¶ä¿å­˜åˆ° `tree.txt` |

> **å¿«é€Ÿå¯åŠ¨**ï¼šåŒå‡» `start.bat` æˆ–åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `.\start.bat`  
> **æ¸…ç†ç¼“å­˜**ï¼š`python clear_cache.py`  
> **ç”Ÿæˆç»“æ„æ ‘**ï¼š`.\generate_tree.bat`

## å…­ã€ç›‘æ§ä¸è¿ç»´
- æ•°æ®åº“æŸ¥çœ‹ï¼šæ¨èä½¿ç”¨ **DBeaver**ï¼ˆè·¨å¹³å°ï¼Œæ”¯æŒ SQLite/MySQL/PostgreSQL ç­‰ï¼‰ï¼Œå¯ç›´è§‚æµè§ˆè¡¨ç»“æ„ä¸æ•°æ®ã€‚
- æ—¥å¿—æŸ¥çœ‹ï¼ˆapp.logï¼‰ï¼šå¯ç”¨å‘½ä»¤è¡Œå®æ—¶æŸ¥çœ‹ï¼ˆLinux/Macï¼š`tail -f backend/logs/app.log`ï¼ŒWindows PowerShellï¼š`Get-Content backend/logs/app.log -Wait`ï¼‰ï¼Œæˆ–ä½¿ç”¨æ—¥å¿—æŸ¥çœ‹å·¥å…·ï¼ˆå¦‚ lnav/BareTail/IDE å†…ç½® Log Viewerï¼‰
- 