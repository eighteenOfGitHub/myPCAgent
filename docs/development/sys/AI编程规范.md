### **AI生成Python代码编程规范 (For Compliance & Quality)**

**版本:** 1.0.1
**目标:** 确保AI生成的Python代码符合通用编程最佳实践，提高代码质量、可读性、安全性和可维护性。

---

**新增细节：**  

 - 如果生成代码文件，根据项目结构，在第一行必须注释文件所在父目录的相对路径。比如： XXX/XXX.py
 - 不允许生成指定需求意外的内容


---

#### **1. 代码格式与风格 (Code Formatting & Style)**

*   **风格指南:** 严格遵循 [PEP 8](https://peps.python.org/pep-0008/) Python代码风格指南。
*   **缩进:** 使用4个空格进行缩进，禁止使用制表符（Tab）。
*   **行长度:** 每行代码长度不应超过79个字符（对于文档字符串和注释，可放宽至72个字符）。长行应使用括号进行隐式换行或反斜杠 `\` 进行显式换行（优先使用括号）。
*   **命名约定:**
    *   `变量名` 和 `函数名`: 使用 `snake_case` (小写字母，单词间用下划线分隔)。
    *   `类名`: 使用 `CapWords` (每个单词首字母大写)。
    *   `常量名`: 使用 `UPPER_CASE` (大写字母，单词间用下划线分隔)。
    *   避免使用单字符变量名（`l`, `O`, `I`），除非在非常简单的上下文中。
*   **空行:**
    *   模块级函数和类定义之间空两行。
    *   类内方法定义之间空一行。
    *   在函数/方法内部，根据逻辑适当使用空行以提高可读性。
*   **导入:**
    *   导入语句应始终在文件顶部，位于模块注释和文档字符串之后。
    *   导入应分组，顺序为：标准库导入 -> 第三方库导入 -> 本地应用/库特定导入。每组之间用一个空行分隔。
    *   推荐使用 `import os` 而非 `from os import *`。
    *   尽量避免使用 `import ... as ...` 重命名，除非是为了遵循约定（如 `import numpy as np`）或处理名称冲突。
*   **空格:**
    *   在二元运算符（`=`, `+`, `-`, `==`, `!=`, `<`, `>`, `<=`, `>=`, `in`, `not in`, `is`, `is not`）两边各加一个空格。
    *   在逗号、分号、冒号后面加一个空格（冒号在切片中不加空格）。
    *   在函数参数列表、索引和切片的左括号前不加空格。

#### **2. 文档与注释 (Documentation & Comments)**

*   **函数/方法文档字符串:** 每个函数和方法都必须包含一个文档字符串，使用 [Google Style](https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings) 标准格式，清晰说明其功能、参数类型和名称、返回值类型和名称、可能抛出的异常。
*   **类文档字符串:** 每个类都应包含一个文档字符串，描述类的用途、属性和主要方法。
*   **行内注释:** 对于复杂或非显而易见的代码逻辑，应添加行内注释 (`# ` 开头) 进行解释。注释应简洁明了，与代码保持同步。
*   **块注释:** 对于一段代码的逻辑说明，应在该段代码前添加块注释，每行以 `# ` 开头。
*   **避免冗余注释:** 不要为显而易见的代码写注释（如 `i = i + 1 # increment i`）。

#### **3. 代码结构与逻辑 (Code Structure & Logic)**

*   **函数设计:**
    *   遵循单一职责原则，一个函数只做一件事。
    *   函数长度应适中，通常不应超过50行（不包括文档字符串和注释）。
    *   使用类型提示 (`def func(x: int, y: str) -> bool:`) 来明确参数和返回值的类型。
    *   优先使用不可变对象（如 `tuple`, `frozenset`）和避免可变默认参数（如 `def func(items=[]):` 是错误的）。
*   **异常处理:**
    *   使用 `try...except...finally` 结构进行异常处理。
    *   捕获具体异常类型，避免使用裸露的 `except:`。
    *   在 `except` 块中处理异常或记录日志，避免空的 `except` 块（`except: pass`）。
    *   合理使用 `else` 和 `finally` 子句。
*   **避免魔法数字和字符串:** 将代码中出现的硬编码数字和字符串定义为具有描述性名称的常量。
*   **循环与条件:**
    *   优先使用 `for` 循环和列表推导式，而非 `while` 循环（除非必须）。
    *   避免过度嵌套，通常嵌套深度不应超过3层。如果嵌套过深，应考虑重构。
    *   使用 `if/elif/else` 链时，确保逻辑清晰，考虑使用字典映射或策略模式来简化复杂的条件判断。
*   **变量作用域:** 尽量缩小变量的作用域，优先在函数内部定义变量。

#### **4. 安全性 (Security)**

*   **输入验证:** 对所有外部输入（用户输入、文件读取、网络请求等）进行严格的验证和清理，防止注入攻击（如SQL注入、命令注入、路径遍历）。
*   **避免 `exec()` 和 `eval()`:** 禁止使用 `exec()` 和 `eval()` 处理不可信的输入，这可能导致任意代码执行。
*   **文件操作:** 在处理文件路径时，使用 `os.path.join()` 或 `pathlib` 来构建路径，并验证路径是否在预期的目录内，防止路径遍历攻击。
*   **密码和密钥:** 严禁在代码中硬编码任何密码、API密钥或敏感信息。应使用环境变量或安全的配置管理工具来管理。
*   **依赖库:** 仅使用来源可靠、维护良好的第三方库，并定期检查和更新依赖库，以修复已知的安全漏洞。

#### **5. 性能与效率 (Performance & Efficiency)**

*   **内置函数和数据结构:** 优先使用Python内置的高效函数（如 `map()`, `filter()`, `sum()`）和数据结构（如 `set`, `dict` 查找）。
*   **列表推导式与生成器:** 在创建列表或需要迭代处理数据时，考虑使用列表推导式或生成器表达式，它们通常比显式循环更高效、更简洁。
*   **字符串拼接:** 对于大量字符串拼接，使用 `''.join(list_of_strings)` 而非 `+` 或 `+=`。
*   **避免重复计算:** 对于昂贵的计算或I/O操作，考虑缓存结果（如使用 `functools.lru_cache`）。

#### **6. 测试与可测试性 (Testing & Testability)**

*   **可测试设计:** 编写易于测试的代码，例如将业务逻辑与I/O操作分离。
*   **单元测试:** 生成代码时，应考虑其可测试性，并建议或生成相应的单元测试用例（ `pytest` 框架）。

---

**请在生成代码时，时刻遵循以上规范。** 这份规范旨在帮助你生成高质量、安全且易于维护的Python代码。